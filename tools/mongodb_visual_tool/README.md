# Ismism-Machine MongoDB可视化工具

## 简介

这是一个专为Ismism-Machine项目设计的MongoDB数据库可视化工具，用于方便地管理艺术数据库中的内容。它提供了直观的界面来浏览、搜索、编辑MongoDB中的文档，以及处理图像和关系数据。

## 特性

1. 简单直观的图形界面，支持网格视图和列表视图
2. 显示数据库中的图片及其元数据
3. 创建和管理文档之间的关系
4. 导出文档为JSON格式（单个或批量）
5. 使用右键菜单访问更多功能（查看详情、创建关系、导出、删除等）
6. 使用底部的分页控件浏览更多内容
7. 数据库和文件同步验证，确保数据一致性
8. 支持搜索和筛选功能，并保存搜索历史
9. 多重选择支持（框选、Shift选择范围、Ctrl添加/删除选择）

## 项目结构

工具采用模块化的结构，便于扩展和维护：

```
mongodb_visual_tool/
├── app.py                 # 主启动器，检查环境并启动应用
├── main.py                # 主应用程序
├── modules/               # 模块化组件
│   ├── config/            # 配置相关
│   │   ├── settings.py    # 全局设置
│   │   └── config_manager.py # 配置管理
│   ├── db/                # 数据库相关
│   │   ├── mongo_manager.py # MongoDB连接管理
│   │   └── validator.py   # 数据验证
│   ├── ui/                # 用户界面组件
│   │   ├── image_card.py  # 图像卡片组件
│   │   └── paginated_grid.py # 分页网格组件
│   └── utils/             # 通用工具
│       └── image_loader.py # 图像加载器
└── README.md              # 本文档
```

## 使用方法

### 启动应用

最简单的方法是运行app.py启动器：

```bash
python app.py
```

启动器会:
1. 检查Python环境
2. 验证所需依赖是否已安装
3. 检查应用程序模块是否完整
4. 启动主应用程序

### 连接数据库

1. 启动应用后，在连接框中输入MongoDB URI（默认为`mongodb://localhost:27017`）
2. 点击"连接"按钮
3. 从左侧树状视图中选择数据库和集合
4. 右侧将显示集合中的文档

### 基本操作

- 点击图像卡片可选择/取消选择文档
- 右键点击图像可访问上下文菜单
- 使用顶部搜索框搜索特定文档
- 使用视图切换按钮在网格视图和列表视图之间切换
- 使用底部分页控件浏览更多内容
- 选择多个文档进行批量操作（导出、关系创建等）
- 拖动鼠标可框选多个文档

### 删除操作

1. 右键点击要删除的文档
2. 选择"删除"选项
3. 确认删除操作
4. 系统将从数据库中删除文档，并询问是否要删除关联的文件

### 创建关系

1. 选择一个或多个源文档
2. 右键点击并选择"创建关系"，或使用批量操作按钮
3. 在弹出的对话框中选择目标数据库、集合和文档
4. 选择关系类型
5. 点击"创建关系"确认

## 数据一致性

工具启动时会自动检查数据库记录与文件系统的一致性，如果发现问题：
- 显示警告消息指出不一致问题
- 在问题记录上标记⚠️警告图标
- 将详细信息记录到日志文件（`db_file_inconsistencies.log`）

## 配置和设置

应用程序会记住以下设置：
- 上次使用的MongoDB URI
- 是否在启动时自动连接
- 上次选择的数据库和集合
- 网格视图的列数

## 系统要求

- Python 3.6+
- 依赖库：
  - pymongo 4.6.0
  - Pillow 10.0.0 (PIL)
  - python-dotenv 1.0.0
  - rapidfuzz 3.13.0
  - tkinter (系统库)

## 关于此工具

此工具是Ismism-Machine项目的一个实用工具，用于更直观地管理和编辑艺术数据库中的内容。它解决了MongoDB Compass无法直接预览图片或管理复杂关系的问题。 